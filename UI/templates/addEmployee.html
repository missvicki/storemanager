<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Store Manager application, Admin dashboard">
        <meta name="author" content="Victor Nomwesigwa">
        <meta name="HandheldFriendly" content="true">

        <title>V & M Shopping</title>
        <!--Stylesheet-->
        <link rel="stylesheet" type="text/css" href="../css/index.css" />

        <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>

        <script>
            function signup(){
                var empname = document.getElementById("name_employee").value;
                var empuserName = document.getElementById("name_user").value;
                var empPassword = document.getElementById("password_employee").value;
                var verPassword = document.getElementById("psd_verified").value;
                var empRole = document.getElementById("role").value;

                var newtoken = localStorage.getItem('token');
                console.log(newtoken)

                if(empname == "" || empuserName == "" || empPassword == "" || verPassword == "" || empRole == ""){
                    alert("Fields should not be empty")
                }else{
                    //fetch url, define method of request and its parameters
                    fetch('https://store-manager-ap1.herokuapp.com/api/v2/auth/signup',{
                        method:'POST',
                        headers: {
                            'Content-type': 'application/json',
                            'Authorization': `Bearer ${newtoken}`
                        },
                        body: JSON.stringify({name: empname, user_name: empuserName, password:empPassword, role: empRole})
                    }).then((response) => {
                        if (response.ok){
                            return response.text()
                            .then((data) => {
                                alert(data)
                            })
                        }else if(response.status == 400){
                            alert(response.statusText + "-" + "user already exists or bad input data")
                        }else if(response.status == 401){
                            alert(response.statusText + "-" + "You are unauthorized to perform this action")
                        }else{
                            alert(response.status + "-" + response.statusText)
                        }                 
                    })
                    .catch (console.error)
                }
            }
        </script>

    </head>
    <body>
        <header class="dashboard">
            <div class="logo-section">
                <a href="indexOwner.html"> V&M <span>Shopping</span></a>
            </div>
        </header>

        <div class="main-section">
            <aside id="side-menu">
                <ul class="menu">                        
                    <li><a href="indexOwner.html">Dashboard</a> </li>
                    <li><a href="salesOwner.html">Sales</a> </li>
                    <li><a class="selected" href="employess.html">Employees</a> </li>
                    <li><a href="manageProducts.html">Products</a> </li>                                    
                    <li><a href="index.html">Logout</a> </li>   
                </ul>
            </aside>
            <div class="content">
                <div class="main-info">
                    <div class="down-section">
                        <div class="add-form">
                            <div class="add-section">
                                <form>   
                                    <h5>Create a new User</h5>                            
                                    <div class="form-wrap">
                                        <label>Employee Name</label>
                                        <input type = "text" id = "name_employee" name="name_employee" placeholder="Name" required>
                                    </div>
                                    <div class="form-wrap">
                                        <label>Username</label>
                                        <input type = "text" id = "name_user" name="name_user" placeholder="Username" required>
                                    </div>
                                    <div class="form-wrap">
                                        <label>Password</label> 
                                        <input type="password" id="password_employee" name="password_employee" placeholder="Password" required>
                                    </div>
                                    <div class="form-wrap">
                                        <label>Verify Password</label> 
                                        <input type="password" id="psd_verified" name="psd_verified" placeholder="Verify Password" required>
                                    </div>
                                    <br>
                                    <select name="role" id="role">
                                        <option value="">Select Role</option>
                                        <option value="admin">Store Owner</option>
                                        <option value="attendant">Store Attendant</option>
                                    </select>
                                    <br>
                                    <br>
                                    <div class="form-wrap btn">
                                        <input type="button" onclick="signup()" name="add1" value="Add New User">
                                    </div>       
                                </form>
                            </div>
                        </div>                           
                    </div>
                </div> 
            </div>
        </div>
    </body>
</html>