<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <!--Responsive webdesign link-->
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="HandheldFriendly" content="true">

        <title>Login-V&M Shopping</title>
        <!--css style link-->
        <link rel="stylesheet" href="../css/index.css">
        <!--Material icon link-->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

        <script>
            function login(){
                var userName = document.getElementById("usernamefield").value;
                var userPassword = document.getElementById("passwordfield").value;
                var userRole = document.getElementById("role").value;

                if(userName == "" || userPassword == "" || userRole == ""){
                    alert("Fields should not be empty")
                }else{
                    //fetch url, define method of request and its parameters
                    fetch('https://store-manager-ap1.herokuapp.com/api/v2/auth/login',{
                        method:'POST',
                        headers: {
                            'Content-type': 'application/json'
                        },
                        body: JSON.stringify({user_name: userName, password: userPassword, role: userRole})
                    }).then((response) => {
                        if (response.ok){
                            return response.text()
                            .then((data) => {
                                console.log(data)
                                var accesstoken = JSON.parse(data)
                                var token = accesstoken["access_token"]

                                localStorage.setItem('token', token)
                                if (userRole == 'admin'){
                                    alert("Login Successful...Redirecting to admin page")
                                    redirect: window.location.replace("indexOwner.html") 
                                }
                                else if (userRole == 'attendant'){
                                    alert("Login Successful...Redirecting to attendants page")
                                    redirect: window.location.replace("indexAttendants.html") 
                                }
                                else{
                                    alert("I don't know you")
                                }
                            })
                        }else if(response.status == 400){
                            alert(response.statusText + "-" + "either wrong username, password, role")
                        }else if(response.status == 404){
                            alert(response.statusText + "-" + "user does not exist, please signup")
                        }else{
                            alert(response.status + "-" + response.statusText)
                        }                      
                    })
                    .catch (console.error)
                }
            }
        </script>
    </head>
        <body>
            
            <div class="container" style="background-image: url(../images/shoppingbackground.jpg)">
                <header>
                    <h1>V & M Shopping</h1>
                </header>
                <div class="login-content">
                    <div class="login-form">
                        <div class="login-section">
                            <h1>Sign In</h1>
                            <form>
                                <div class="form-wrap">
                                    <label>Username</label>
                                    <input type = "text" name="username" placeholder="Enter your username" id="usernamefield" required>
                                </div>

                                <div class="form-wrap">
                                    <label>Password</label> 
                                    <input type="password" name="pswd" placeholder="Enter your Password" id = "passwordfield" required>
                                </div>
                                <div class="form-wrap">
                                    <select name="role" id="role">
                                        <option value="">Select Role</option>
                                        <option value="admin">Store Owner</option>
                                        <option value="attendant">Store Attendant</option>
                                    </select>
                                </div>
                                <div class="form-wrap btn">
                                    <input type="button" onclick="login()" name="signin" value="Sign In">
                                </div>                                    
                            </form>
                            
                        </div-class>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>